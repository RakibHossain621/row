{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Rokibul\\\\Documents\\\\case\\\\src\\\\antmedia\\\\Player.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nimport { useEffect, useRef } from 'react';\nimport classnames from 'classnames';\nimport videojs from 'video.js';\nimport { useSelector } from 'react-redux';\nimport { tryToPlay } from './utils';\nlet player;\nlet interval;\nlet _streamId;\nconst leaveSession = () => {\n  if (player) {\n    player.dispose();\n    player = undefined;\n  }\n  const el = document.getElementById(_streamId);\n  if (el) {\n    el.remove();\n  }\n  if (interval) {\n    clearTimeout(interval);\n    interval = undefined;\n  }\n};\nconst Player = _ref => {\n  let {\n      streamId,\n      className,\n      extension,\n      token,\n      subscriberId,\n      subscriberCode\n    } = _ref,\n    props = _objectWithoutProperties(_ref, [\"streamId\", \"className\", \"extension\", \"token\", \"subscriberId\", \"subscriberCode\"]);\n  const ref = useRef();\n  const settings = useSelector(state => state.streaming.settings);\n  const {\n    viewerURL,\n    AntMediaAppname\n  } = settings;\n  const initializePlayer = () => {\n    if (interval) {\n      clearTimeout(interval);\n      interval = undefined;\n    }\n    let el = document.getElementById(streamId);\n    if (!el) {\n      el = document.createElement('video');\n      el.id = streamId;\n      el.className = classnames('video-js vjs-default-skin', className);\n      el.autoplay = true;\n      el.muted = true;\n      el.controls = false;\n      el.playsInline = true;\n      el.width = ref.current.offsetWidth;\n      el.height = ref.current.offsetHeight;\n      ref.current.appendChild(el);\n    }\n    let type;\n    if (extension === 'm3u8') {\n      type = 'application/x-mpegURL';\n    }\n    if (!player) {\n      const videoEl = videojs(el, {\n        controlBar: false,\n        controls: false,\n        bigPlayButton: false,\n        muted: true\n      }, () => {\n        player = videoEl;\n        player.play();\n      });\n      videoEl.addClass('vjs-waiting');\n      videoEl.src({\n        src: `${window.location.protocol}//${viewerURL}/${AntMediaAppname}/streams/${streamId}.${extension}?token=${token}&subscriberId=${subscriberId}&subscriberCode=${subscriberCode}`,\n        type\n      });\n      videoEl.on('ended', () => {\n        videoEl.addClass('vjs-waiting');\n        interval = setTimeout(() => {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n        }, 3000);\n      });\n      videoEl.on('error', () => {\n        videoEl.error(null);\n        videoEl.addClass('vjs-waiting');\n        interval = setTimeout(() => {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n        }, 3000);\n      });\n      return;\n    }\n    player.addClass('vjs-waiting');\n    player.src({\n      src: `${window.location.protocol}//${viewerURL}/${AntMediaAppname}/streams/${streamId}.${extension}?token=${token}&subscriberId=${subscriberId}&subscriberCode=${subscriberCode}`,\n      type\n    });\n    if (player.readyState()) {\n      player.play();\n    }\n  };\n  const noStreamCallback = () => {\n    if (extension === 'm3u8') {\n      interval = setTimeout(() => {\n        tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n      }, 3000);\n    }\n  };\n  useEffect(() => {\n    leaveSession();\n    _streamId = streamId;\n    if (streamId) {\n      tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n    }\n  }, [streamId]);\n\n  // eslint-disable-next-line arrow-body-style\n  useEffect(() => {\n    return () => {\n      leaveSession();\n    };\n  }, []);\n  return __jsx(\"div\", _extends({}, props, {\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 10\n    }\n  }));\n};\nPlayer.defaultProps = {\n  token: '',\n  subscriberId: '',\n  subscriberCode: '',\n  className: '',\n  containerCls: '',\n  style: {}\n};\nexport default Player;","map":{"version":3,"names":["useEffect","useRef","classnames","videojs","useSelector","tryToPlay","player","interval","_streamId","leaveSession","dispose","undefined","el","document","getElementById","remove","clearTimeout","Player","_ref","streamId","className","extension","token","subscriberId","subscriberCode","props","_objectWithoutProperties","ref","settings","state","streaming","viewerURL","AntMediaAppname","initializePlayer","createElement","id","autoplay","muted","controls","playsInline","width","current","offsetWidth","height","offsetHeight","appendChild","type","videoEl","controlBar","bigPlayButton","play","addClass","src","window","location","protocol","on","setTimeout","noStreamCallback","error","readyState","__jsx","_extends","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","defaultProps","containerCls","style"],"sources":["C:/Users/Rokibul/Documents/case/src/antmedia/Player.tsx"],"sourcesContent":["import { useEffect, useRef, CSSProperties } from 'react';\nimport classnames from 'classnames';\nimport videojs from 'video.js';\nimport { useSelector } from 'react-redux';\nimport { StreamSettings } from 'src/interfaces';\nimport { tryToPlay } from './utils';\n\ninterface Props {\n  streamId: string;\n  className?: string;\n  containerCls?: string;\n  extension: string;\n  token?: string;\n  subscriberId?: string;\n  subscriberCode?: string;\n  style?: CSSProperties;\n}\n\nlet player: videojs.Player;\nlet interval: NodeJS.Timeout;\nlet _streamId: string;\n\nconst leaveSession = () => {\n  if (player) {\n    player.dispose();\n    player = undefined;\n  }\n\n  const el = document.getElementById(_streamId);\n  if (el) {\n    el.remove();\n  }\n\n  if (interval) {\n    clearTimeout(interval);\n    interval = undefined;\n  }\n};\n\nconst Player = ({\n  streamId, className, extension, token, subscriberId, subscriberCode, ...props\n}: Props) => {\n  const ref = useRef<HTMLDivElement>();\n  const settings = useSelector((state: any) => state.streaming.settings) as StreamSettings;\n  const { viewerURL, AntMediaAppname } = settings;\n  const initializePlayer = () => {\n    if (interval) {\n      clearTimeout(interval);\n      interval = undefined;\n    }\n\n    let el = document.getElementById(streamId) as HTMLVideoElement;\n    if (!el) {\n      el = document.createElement('video');\n      el.id = streamId;\n      el.className = classnames('video-js vjs-default-skin', className);\n      el.autoplay = true;\n      el.muted = true;\n      el.controls = false;\n      el.playsInline = true;\n      el.width = ref.current.offsetWidth;\n      el.height = ref.current.offsetHeight;\n      ref.current.appendChild(el);\n    }\n\n    let type: string;\n    if (extension === 'm3u8') {\n      type = 'application/x-mpegURL';\n    }\n\n    if (!player) {\n      const videoEl = videojs(el, {\n        controlBar: false,\n        controls: false,\n        bigPlayButton: false,\n        muted: true\n      }, () => {\n        player = videoEl;\n        player.play();\n      });\n\n      videoEl.addClass('vjs-waiting');\n      videoEl.src({\n        src: `${window.location.protocol}//${viewerURL}/${AntMediaAppname}/streams/${streamId}.${extension}?token=${token}&subscriberId=${subscriberId}&subscriberCode=${subscriberCode}`,\n        type\n      });\n\n      videoEl.on('ended', () => {\n        videoEl.addClass('vjs-waiting');\n        interval = setTimeout(() => {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n        }, 3000);\n      });\n\n      videoEl.on('error', () => {\n        videoEl.error(null);\n        videoEl.addClass('vjs-waiting');\n        interval = setTimeout(() => {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n        }, 3000);\n      });\n\n      return;\n    }\n\n    player.addClass('vjs-waiting');\n    player.src({\n      src: `${window.location.protocol}//${viewerURL}/${AntMediaAppname}/streams/${streamId}.${extension}?token=${token}&subscriberId=${subscriberId}&subscriberCode=${subscriberCode}`,\n      type\n    });\n    if (player.readyState()) {\n      player.play();\n    }\n  };\n\n  const noStreamCallback = () => {\n    if (extension === 'm3u8') {\n      interval = setTimeout(() => {\n        tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n      }, 3000);\n    }\n  };\n\n  useEffect(() => {\n    leaveSession();\n\n    _streamId = streamId;\n\n    if (streamId) {\n      tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\n    }\n  }, [streamId]);\n\n  // eslint-disable-next-line arrow-body-style\n  useEffect(() => {\n    return () => {\n      leaveSession();\n    };\n  }, []);\n\n  return <div {...props} ref={ref} />;\n};\n\nPlayer.defaultProps = {\n  token: '',\n  subscriberId: '',\n  subscriberCode: '',\n  className: '',\n  containerCls: '',\n  style: {}\n};\nexport default Player;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}