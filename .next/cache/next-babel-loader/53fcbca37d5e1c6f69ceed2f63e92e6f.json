{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"streamId\", \"className\", \"extension\", \"token\", \"subscriberId\", \"subscriberCode\"];\nvar _this = this,\n  _jsxFileName = \"C:\\\\Users\\\\roman\\\\Pictures\\\\Case\\\\row\\\\src\\\\antmedia\\\\Player.tsx\",\n  _s = $RefreshSig$();\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, useRef } from 'react';\nimport classnames from 'classnames';\nimport videojs from 'video.js';\nimport { useSelector } from 'react-redux';\nimport { tryToPlay } from './utils';\nvar player;\nvar interval;\nvar _streamId;\nvar leaveSession = function leaveSession() {\n  if (player) {\n    player.dispose();\n    player = undefined;\n  }\n  var el = document.getElementById(_streamId);\n  if (el) {\n    el.remove();\n  }\n  if (interval) {\n    clearTimeout(interval);\n    interval = undefined;\n  }\n};\nvar Player = function Player(_ref) {\n  _s();\n  var streamId = _ref.streamId,\n    className = _ref.className,\n    extension = _ref.extension,\n    token = _ref.token,\n    subscriberId = _ref.subscriberId,\n    subscriberCode = _ref.subscriberCode,\n    props = _objectWithoutProperties(_ref, _excluded);\n  var ref = useRef();\n  var settings = useSelector(function (state) {\n    return state.streaming.settings;\n  });\n  var viewerURL = settings.viewerURL,\n    AntMediaAppname = settings.AntMediaAppname;\n  var _initializePlayer = function initializePlayer() {\n    if (interval) {\n      clearTimeout(interval);\n      interval = undefined;\n    }\n    var el = document.getElementById(streamId);\n    if (!el) {\n      el = document.createElement('video');\n      el.id = streamId;\n      el.className = classnames('video-js vjs-default-skin', className);\n      el.autoplay = true;\n      el.muted = true;\n      el.controls = false;\n      el.playsInline = true;\n      el.width = ref.current.offsetWidth;\n      el.height = ref.current.offsetHeight;\n      ref.current.appendChild(el);\n    }\n    var type;\n    if (extension === 'm3u8') {\n      type = 'application/x-mpegURL';\n    }\n    if (!player) {\n      var videoEl = videojs(el, {\n        controlBar: false,\n        controls: false,\n        bigPlayButton: false,\n        muted: true\n      }, function () {\n        player = videoEl;\n        player.play();\n      });\n      videoEl.addClass('vjs-waiting');\n      videoEl.src({\n        src: \"\".concat(window.location.protocol, \"//\").concat(viewerURL, \"/\").concat(AntMediaAppname, \"/streams/\").concat(streamId, \".\").concat(extension, \"?token=\").concat(token, \"&subscriberId=\").concat(subscriberId, \"&subscriberCode=\").concat(subscriberCode),\n        type: type\n      });\n      videoEl.on('ended', function () {\n        videoEl.addClass('vjs-waiting');\n        interval = setTimeout(function () {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, _noStreamCallback, _initializePlayer);\n        }, 3000);\n      });\n      videoEl.on('error', function () {\n        videoEl.error(null);\n        videoEl.addClass('vjs-waiting');\n        interval = setTimeout(function () {\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, _noStreamCallback, _initializePlayer);\n        }, 3000);\n      });\n      return;\n    }\n    player.addClass('vjs-waiting');\n    player.src({\n      src: \"\".concat(window.location.protocol, \"//\").concat(viewerURL, \"/\").concat(AntMediaAppname, \"/streams/\").concat(streamId, \".\").concat(extension, \"?token=\").concat(token, \"&subscriberId=\").concat(subscriberId, \"&subscriberCode=\").concat(subscriberCode),\n      type: type\n    });\n    if (player.readyState()) {\n      player.play();\n    }\n  };\n  var _noStreamCallback = function noStreamCallback() {\n    if (extension === 'm3u8') {\n      interval = setTimeout(function () {\n        tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, _noStreamCallback, _initializePlayer);\n      }, 3000);\n    }\n  };\n  useEffect(function () {\n    leaveSession();\n    _streamId = streamId;\n    if (streamId) {\n      tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, _noStreamCallback, _initializePlayer);\n    }\n  }, [streamId]);\n\n  // eslint-disable-next-line arrow-body-style\n  useEffect(function () {\n    return function () {\n      leaveSession();\n    };\n  }, []);\n  return __jsx(\"div\", _extends({}, props, {\n    ref: ref,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 10\n    }\n  }));\n};\n_s(Player, \"aTQrIMMbzMcEnXiOqF2+/kirzTs=\", false, function () {\n  return [useSelector];\n});\n_c = Player;\nPlayer.defaultProps = {\n  token: '',\n  subscriberId: '',\n  subscriberCode: '',\n  className: '',\n  containerCls: '',\n  style: {}\n};\nexport default Player;\nvar _c;\n$RefreshReg$(_c, \"Player\");","map":{"version":3,"names":["useEffect","useRef","classnames","videojs","useSelector","tryToPlay","player","interval","_streamId","leaveSession","dispose","undefined","el","document","getElementById","remove","clearTimeout","Player","_ref","_s","streamId","className","extension","token","subscriberId","subscriberCode","props","_objectWithoutProperties","_excluded","ref","settings","state","streaming","viewerURL","AntMediaAppname","initializePlayer","createElement","id","autoplay","muted","controls","playsInline","width","current","offsetWidth","height","offsetHeight","appendChild","type","videoEl","controlBar","bigPlayButton","play","addClass","src","concat","window","location","protocol","on","setTimeout","noStreamCallback","error","readyState","__jsx","_extends","__self","_this","__source","fileName","_jsxFileName","lineNumber","columnNumber","_c","defaultProps","containerCls","style","$RefreshReg$"],"sources":["C:/Users/roman/Pictures/Case/row/src/antmedia/Player.tsx"],"sourcesContent":["import { useEffect, useRef, CSSProperties } from 'react';\r\nimport classnames from 'classnames';\r\nimport videojs from 'video.js';\r\nimport { useSelector } from 'react-redux';\r\nimport { StreamSettings } from 'src/interfaces';\r\nimport { tryToPlay } from './utils';\r\n\r\ninterface Props {\r\n  streamId: string;\r\n  className?: string;\r\n  containerCls?: string;\r\n  extension: string;\r\n  token?: string;\r\n  subscriberId?: string;\r\n  subscriberCode?: string;\r\n  style?: CSSProperties;\r\n}\r\n\r\nlet player: videojs.Player;\r\nlet interval: NodeJS.Timeout;\r\nlet _streamId: string;\r\n\r\nconst leaveSession = () => {\r\n  if (player) {\r\n    player.dispose();\r\n    player = undefined;\r\n  }\r\n\r\n  const el = document.getElementById(_streamId);\r\n  if (el) {\r\n    el.remove();\r\n  }\r\n\r\n  if (interval) {\r\n    clearTimeout(interval);\r\n    interval = undefined;\r\n  }\r\n};\r\n\r\nconst Player = ({\r\n  streamId, className, extension, token, subscriberId, subscriberCode, ...props\r\n}: Props) => {\r\n  const ref = useRef<HTMLDivElement>();\r\n  const settings = useSelector((state: any) => state.streaming.settings) as StreamSettings;\r\n  const { viewerURL, AntMediaAppname } = settings;\r\n  const initializePlayer = () => {\r\n    if (interval) {\r\n      clearTimeout(interval);\r\n      interval = undefined;\r\n    }\r\n\r\n    let el = document.getElementById(streamId) as HTMLVideoElement;\r\n    if (!el) {\r\n      el = document.createElement('video');\r\n      el.id = streamId;\r\n      el.className = classnames('video-js vjs-default-skin', className);\r\n      el.autoplay = true;\r\n      el.muted = true;\r\n      el.controls = false;\r\n      el.playsInline = true;\r\n      el.width = ref.current.offsetWidth;\r\n      el.height = ref.current.offsetHeight;\r\n      ref.current.appendChild(el);\r\n    }\r\n\r\n    let type: string;\r\n    if (extension === 'm3u8') {\r\n      type = 'application/x-mpegURL';\r\n    }\r\n\r\n    if (!player) {\r\n      const videoEl = videojs(el, {\r\n        controlBar: false,\r\n        controls: false,\r\n        bigPlayButton: false,\r\n        muted: true\r\n      }, () => {\r\n        player = videoEl;\r\n        player.play();\r\n      });\r\n\r\n      videoEl.addClass('vjs-waiting');\r\n      videoEl.src({\r\n        src: `${window.location.protocol}//${viewerURL}/${AntMediaAppname}/streams/${streamId}.${extension}?token=${token}&subscriberId=${subscriberId}&subscriberCode=${subscriberCode}`,\r\n        type\r\n      });\r\n\r\n      videoEl.on('ended', () => {\r\n        videoEl.addClass('vjs-waiting');\r\n        interval = setTimeout(() => {\r\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\r\n        }, 3000);\r\n      });\r\n\r\n      videoEl.on('error', () => {\r\n        videoEl.error(null);\r\n        videoEl.addClass('vjs-waiting');\r\n        interval = setTimeout(() => {\r\n          // eslint-disable-next-line @typescript-eslint/no-use-before-define\r\n          tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\r\n        }, 3000);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    player.addClass('vjs-waiting');\r\n    player.src({\r\n      src: `${window.location.protocol}//${viewerURL}/${AntMediaAppname}/streams/${streamId}.${extension}?token=${token}&subscriberId=${subscriberId}&subscriberCode=${subscriberCode}`,\r\n      type\r\n    });\r\n    if (player.readyState()) {\r\n      player.play();\r\n    }\r\n  };\r\n\r\n  const noStreamCallback = () => {\r\n    if (extension === 'm3u8') {\r\n      interval = setTimeout(() => {\r\n        tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\r\n      }, 3000);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    leaveSession();\r\n\r\n    _streamId = streamId;\r\n\r\n    if (streamId) {\r\n      tryToPlay(viewerURL, AntMediaAppname, streamId, token, extension, subscriberId, subscriberCode, noStreamCallback, initializePlayer);\r\n    }\r\n  }, [streamId]);\r\n\r\n  // eslint-disable-next-line arrow-body-style\r\n  useEffect(() => {\r\n    return () => {\r\n      leaveSession();\r\n    };\r\n  }, []);\r\n\r\n  return <div {...props} ref={ref} />;\r\n};\r\n\r\nPlayer.defaultProps = {\r\n  token: '',\r\n  subscriberId: '',\r\n  subscriberCode: '',\r\n  className: '',\r\n  containerCls: '',\r\n  style: {}\r\n};\r\nexport default Player;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}